/*!
 * FilePondPluginImageEdit 1.5.0
 * Licensed under MIT, https://opensource.org/licenses/MIT/
 * Please visit https://pqina.nl/filepond/ for details.
 */

/* eslint-disable */

const t=t=>/^image/.test(t.type),e=e=>{const{addFilter:i,utils:o,views:n}=e,{Type:r,createRoute:l,createItemAPI:a=(t=>t)}=o,{fileActionButton:E}=n;i("SHOULD_REMOVE_ON_REVERT",(e,{item:i,query:o})=>new Promise(e=>{const{file:n}=i;e(!(o("GET_ALLOW_IMAGE_PREVIEW")&&o("GET_ALLOW_IMAGE_EDIT")&&o("GET_IMAGE_EDIT_ALLOW_EDIT")&&t(n)))})),i("DID_LOAD_ITEM",(e,{query:i,dispatch:o})=>new Promise((n,r)=>{if(e.origin>1)return void n(e);const{file:l}=e;if(!i("GET_ALLOW_IMAGE_PREVIEW")||!i("GET_ALLOW_IMAGE_EDIT")||!i("GET_IMAGE_EDIT_INSTANT_EDIT"))return void n(e);if(!t(l))return void n(e);const a=(t,e,i)=>n=>{d.shift(),n?e(t):i(t),o("KICK"),E()},E=()=>{if(!d.length)return;const{item:t,resolve:e,reject:i}=d[0];o("EDIT_ITEM",{id:t.id,handleEditorResponse:a(t,e,i)})};c({item:e,resolve:n,reject:r}),1===d.length&&E()})),i("DID_CREATE_ITEM",(t,{query:e,dispatch:i})=>{t.extend("edit",()=>{i("EDIT_ITEM",{id:t.id})})});const d=[],c=t=>(d.push(t),t);return i("CREATE_VIEW",e=>{const{is:i,view:o,query:n}=e;if(!i("file")||!n("GET_ALLOW_IMAGE_PREVIEW")||!n("GET_ALLOW_IMAGE_EDIT"))return;const r=n("GET_IMAGE_EDIT_EDITOR");if(!r)return;r.filepondCallbackBridge||(r.outputData=!0,r.outputFile=!1,r.cropAspectRatio=n("GET_IMAGE_CROP_ASPECT_RATIO")||r.cropAspectRatio,r.outputCanvasBackgroundColor=n("GET_IMAGE_TRANSFORM_CANVAS_BACKGROUND_COLOR")||r.outputCanvasBackgroundColor,r.filepondCallbackBridge={onconfirm:r.onconfirm||(()=>{}),oncancel:r.oncancel||(()=>{})});o.registerDestroyer(({root:t})=>{t.ref.buttonEditItem&&t.ref.buttonEditItem.off("click",t.ref.handleEdit)}),o.registerWriter(l({DID_IMAGE_PREVIEW_SHOW:({root:t})=>{t.ref.buttonEditItem&&(t.ref.buttonEditItem.opacity=1)},DID_LOAD_ITEM:({root:e,props:i})=>{if(!n("GET_IMAGE_EDIT_ALLOW_EDIT"))return;const{id:r}=i,l=n("GET_ITEM",r);if(!l)return;const a=l.file;if(!t(a))return;const d=o.createChildView(E,{label:"edit",icon:n("GET_IMAGE_EDIT_ICON_EDIT"),opacity:0});d.element.classList.add("filepond--action-edit-item"),d.element.dataset.align=n("GET_STYLE_IMAGE_EDIT_BUTTON_EDIT_ITEM_POSITION"),e.ref.handleEdit=(t=>{t.stopPropagation(),e.dispatch("EDIT_ITEM",{id:r})}),d.on("click",e.ref.handleEdit),e.ref.buttonEditItem=o.appendChildView(d)},EDIT_ITEM:({root:t,props:e,action:i})=>{const{id:o}=e,{handleEditorResponse:n}=i,l=t.query("GET_ITEM",o);if(!l)return;const E=l.file,d=l.getMetadata("crop"),c=l.getMetadata("resize"),s=l.getMetadata("filter")||null,I=l.getMetadata("filters")||null,_=l.getMetadata("colors")||null,u=l.getMetadata("markup")||null,T={crop:d||{center:{x:.5,y:.5},flip:{horizontal:!1,vertical:!1},zoom:1,rotation:0,aspectRatio:null},size:c?{upscale:c.upscale,mode:c.mode,width:c.size.width,height:c.size.height}:null,filter:I?I.id||I.matrix:s,color:_,markup:u};r.onconfirm=(({data:t})=>{const{crop:e,size:i,filter:o,color:E,colorMatrix:d,markup:c}=t,s={};if(e&&(s.crop=e),i){const t=(l.getMetadata("resize")||{}).size,e={width:i.width,height:i.height};e.width&&e.height||!t||(e.width=t.width,e.height=t.height),(e.width||e.height)&&(s.resize={upscale:i.upscale,mode:i.mode,size:e})}c&&(s.markup=c),s.colors=E,s.filters=o,s.filter=d,l.setMetadata(s),r.filepondCallbackBridge.onconfirm(t,a(l)),n&&(r.onclose=(()=>{n(!0),r.onclose=null}))}),r.oncancel=(()=>{r.filepondCallbackBridge.oncancel(a(l)),n&&(r.onclose=(()=>{n(!1),r.onclose=null}))}),r.open(E,T)}}))}),{options:{allowImageEdit:[!0,r.BOOLEAN],styleImageEditButtonEditItemPosition:["bottom center",r.STRING],imageEditInstantEdit:[!1,r.BOOLEAN],imageEditAllowEdit:[!0,r.BOOLEAN],imageEditIconEdit:['<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"><path d="M8.5 17h1.586l7-7L15.5 8.414l-7 7V17zm-1.707-2.707l8-8a1 1 0 0 1 1.414 0l3 3a1 1 0 0 1 0 1.414l-8 8A1 1 0 0 1 10.5 19h-3a1 1 0 0 1-1-1v-3a1 1 0 0 1 .293-.707z" fill="currentColor" fill-rule="nonzero"/></svg>',r.STRING],imageEditEditor:[null,r.OBJECT]}}};"undefined"!=typeof window&&void 0!==window.document&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:e}));export default e;
